################################################################################
# Purpose: This script loads 170 raw datasets downloaded from the USITC, filters
# them for the years 2000 to 2019, and saves the cleaned datasets as RDS files 
# for industry-level analysis.The datasets are named itpder2_1 to itpder2_170.
# ##############################################################################
# Note: When you download the 170 industry raw datasets from the USITC website,
# ensure that the input CSV files are in the "input" directory.
################################################################################


# Clear workspace --------------------------------------------------------------
rm(list = ls())

# Set the working directory ----------------------------------------------------
setwd("C:/Users/muham/EGEI Dissertation/afcfta")


# Load the necessary libraries -------------------------------------------------
library(tidyverse)
library(here)
library(fixest)
library(flextable)
library(huxtable)
library(readr)
library(msm)
library(car)

# Load the data ----------------------------------------------------------------
itpder2_1 <- read_csv("input/ITPD_E_R02_1.csv")
itpder2_2 <- read_csv("input/ITPD_E_R02_2.csv")
itpder2_3 <- read_csv("input/ITPD_E_R02_3.csv")
itpder2_4 <- read_csv("input/ITPD_E_R02_4.csv")
itpder2_5 <- read_csv("input/ITPD_E_R02_5.csv")
itpder2_6 <- read_csv("input/ITPD_E_R02_6.csv")
itpder2_7 <- read_csv("input/ITPD_E_R02_7.csv")
itpder2_8 <- read_csv("input/ITPD_E_R02_8.csv")
itpder2_9 <- read_csv("input/ITPD_E_R02_9.csv")
itpder2_10 <- read_csv("input/ITPD_E_R02_10.csv")
itpder2_11 <- read_csv("input/ITPD_E_R02_11.csv")
itpder2_12 <- read_csv("input/ITPD_E_R02_12.csv")
itpder2_13 <- read_csv("input/ITPD_E_R02_13.csv")
itpder2_14 <- read_csv("input/ITPD_E_R02_14.csv")
itpder2_15 <- read_csv("input/ITPD_E_R02_15.csv")
itpder2_16 <- read_csv("input/ITPD_E_R02_16.csv")
itpder2_17 <- read_csv("input/ITPD_E_R02_17.csv")
itpder2_18 <- read_csv("input/ITPD_E_R02_18.csv")
itpder2_19 <- read_csv("input/ITPD_E_R02_19.csv")
itpder2_20 <- read_csv("input/ITPD_E_R02_20.csv")
itpder2_21 <- read_csv("input/ITPD_E_R02_21.csv")
itpder2_22 <- read_csv("input/ITPD_E_R02_22.csv")
itpder2_23 <- read_csv("input/ITPD_E_R02_23.csv")
itpder2_24 <- read_csv("input/ITPD_E_R02_24.csv")
itpder2_25 <- read_csv("input/ITPD_E_R02_25.csv")
itpder2_26 <- read_csv("input/ITPD_E_R02_26.csv")
itpder2_27 <- read_csv("input/ITPD_E_R02_27.csv")
itpder2_28 <- read_csv("input/ITPD_E_R02_28.csv")
itpder2_29 <- read_csv("input/ITPD_E_R02_29.csv")
itpder2_30 <- read_csv("input/ITPD_E_R02_30.csv")
itpder2_31 <- read_csv("input/ITPD_E_R02_31.csv")
itpder2_32 <- read_csv("input/ITPD_E_R02_32.csv")
itpder2_33 <- read_csv("input/ITPD_E_R02_33.csv")
itpder2_34 <- read_csv("input/ITPD_E_R02_34.csv")
itpder2_35 <- read_csv("input/ITPD_E_R02_35.csv")
itpder2_36 <- read_csv("input/ITPD_E_R02_36.csv")
itpder2_37 <- read_csv("input/ITPD_E_R02_37.csv")
itpder2_38 <- read_csv("input/ITPD_E_R02_38.csv")
itpder2_39 <- read_csv("input/ITPD_E_R02_39.csv")
itpder2_40 <- read_csv("input/ITPD_E_R02_40.csv")
itpder2_41 <- read_csv("input/ITPD_E_R02_41.csv")
itpder2_42 <- read_csv("input/ITPD_E_R02_42.csv")
itpder2_43 <- read_csv("input/ITPD_E_R02_43.csv")
itpder2_44 <- read_csv("input/ITPD_E_R02_44.csv")
itpder2_45 <- read_csv("input/ITPD_E_R02_45.csv")
itpder2_46 <- read_csv("input/ITPD_E_R02_46.csv")
itpder2_47 <- read_csv("input/ITPD_E_R02_47.csv")
itpder2_48 <- read_csv("input/ITPD_E_R02_48.csv")
itpder2_49 <- read_csv("input/ITPD_E_R02_49.csv")
itpder2_50 <- read_csv("input/ITPD_E_R02_50.csv")
itpder2_51 <- read_csv("input/ITPD_E_R02_51.csv")
itpder2_52 <- read_csv("input/ITPD_E_R02_52.csv")
itpder2_53 <- read_csv("input/ITPD_E_R02_53.csv")
itpder2_54 <- read_csv("input/ITPD_E_R02_54.csv")
itpder2_55 <- read_csv("input/ITPD_E_R02_55.csv")
itpder2_56 <- read_csv("input/ITPD_E_R02_56.csv")
itpder2_57 <- read_csv("input/ITPD_E_R02_57.csv")
itpder2_58 <- read_csv("input/ITPD_E_R02_58.csv")
itpder2_59 <- read_csv("input/ITPD_E_R02_59.csv")
itpder2_60 <- read_csv("input/ITPD_E_R02_60.csv")
itpder2_61 <- read_csv("input/ITPD_E_R02_61.csv")
itpder2_62 <- read_csv("input/ITPD_E_R02_62.csv")
itpder2_63 <- read_csv("input/ITPD_E_R02_63.csv")
itpder2_64 <- read_csv("input/ITPD_E_R02_64.csv")
itpder2_65 <- read_csv("input/ITPD_E_R02_65.csv")
itpder2_66 <- read_csv("input/ITPD_E_R02_66.csv")
itpder2_67 <- read_csv("input/ITPD_E_R02_67.csv")
itpder2_68 <- read_csv("input/ITPD_E_R02_68.csv")
itpder2_69 <- read_csv("input/ITPD_E_R02_69.csv")
itpder2_70 <- read_csv("input/ITPD_E_R02_70.csv")
itpder2_71 <- read_csv("input/ITPD_E_R02_71.csv")
itpder2_72 <- read_csv("input/ITPD_E_R02_72.csv")
itpder2_73 <- read_csv("input/ITPD_E_R02_73.csv")
itpder2_74 <- read_csv("input/ITPD_E_R02_74.csv")
itpder2_75 <- read_csv("input/ITPD_E_R02_75.csv")
itpder2_76 <- read_csv("input/ITPD_E_R02_76.csv")
itpder2_77 <- read_csv("input/ITPD_E_R02_77.csv")
itpder2_78 <- read_csv("input/ITPD_E_R02_78.csv")
itpder2_79 <- read_csv("input/ITPD_E_R02_79.csv")
itpder2_80 <- read_csv("input/ITPD_E_R02_80.csv")
itpder2_81 <- read_csv("input/ITPD_E_R02_81.csv")
itpder2_82 <- read_csv("input/ITPD_E_R02_82.csv")
itpder2_83 <- read_csv("input/ITPD_E_R02_83.csv")
itpder2_84 <- read_csv("input/ITPD_E_R02_84.csv")
itpder2_85 <- read_csv("input/ITPD_E_R02_85.csv")
itpder2_86 <- read_csv("input/ITPD_E_R02_86.csv")
itpder2_87 <- read_csv("input/ITPD_E_R02_87.csv")
itpder2_88 <- read_csv("input/ITPD_E_R02_88.csv")
itpder2_89 <- read_csv("input/ITPD_E_R02_89.csv")
itpder2_90 <- read_csv("input/ITPD_E_R02_90.csv")
itpder2_91 <- read_csv("input/ITPD_E_R02_91.csv")
itpder2_92 <- read_csv("input/ITPD_E_R02_92.csv")
itpder2_93 <- read_csv("input/ITPD_E_R02_93.csv")
itpder2_94 <- read_csv("input/ITPD_E_R02_94.csv")
itpder2_95 <- read_csv("input/ITPD_E_R02_95.csv")
itpder2_96 <- read_csv("input/ITPD_E_R02_96.csv")
itpder2_97 <- read_csv("input/ITPD_E_R02_97.csv")
itpder2_98 <- read_csv("input/ITPD_E_R02_98.csv")
itpder2_99 <- read_csv("input/ITPD_E_R02_99.csv")
itpder2_100 <- read_csv("input/ITPD_E_R02_100.csv")
itpder2_101 <- read_csv("input/ITPD_E_R02_101.csv")
itpder2_102 <- read_csv("input/ITPD_E_R02_102.csv")
itpder2_103 <- read_csv("input/ITPD_E_R02_103.csv")
itpder2_104 <- read_csv("input/ITPD_E_R02_104.csv")
itpder2_105 <- read_csv("input/ITPD_E_R02_105.csv")
itpder2_106 <- read_csv("input/ITPD_E_R02_106.csv")
itpder2_107 <- read_csv("input/ITPD_E_R02_107.csv")
itpder2_108 <- read_csv("input/ITPD_E_R02_108.csv")
itpder2_109 <- read_csv("input/ITPD_E_R02_109.csv")
itpder2_110 <- read_csv("input/ITPD_E_R02_110.csv")
itpder2_111 <- read_csv("input/ITPD_E_R02_111.csv")
itpder2_112 <- read_csv("input/ITPD_E_R02_112.csv")
itpder2_113 <- read_csv("input/ITPD_E_R02_113.csv")
itpder2_114 <- read_csv("input/ITPD_E_R02_114.csv")
itpder2_115 <- read_csv("input/ITPD_E_R02_115.csv")
itpder2_116 <- read_csv("input/ITPD_E_R02_116.csv")
itpder2_117 <- read_csv("input/ITPD_E_R02_117.csv")
itpder2_118 <- read_csv("input/ITPD_E_R02_118.csv")
itpder2_119 <- read_csv("input/ITPD_E_R02_119.csv")
itpder2_120 <- read_csv("input/ITPD_E_R02_120.csv")
itpder2_121 <- read_csv("input/ITPD_E_R02_121.csv")
itpder2_122 <- read_csv("input/ITPD_E_R02_122.csv")
itpder2_123 <- read_csv("input/ITPD_E_R02_123.csv")
itpder2_124 <- read_csv("input/ITPD_E_R02_124.csv")
itpder2_125 <- read_csv("input/ITPD_E_R02_125.csv")
itpder2_126 <- read_csv("input/ITPD_E_R02_126.csv")
itpder2_127 <- read_csv("input/ITPD_E_R02_127.csv")
itpder2_128 <- read_csv("input/ITPD_E_R02_128.csv")
itpder2_129 <- read_csv("input/ITPD_E_R02_129.csv")
itpder2_130 <- read_csv("input/ITPD_E_R02_130.csv")
itpder2_131 <- read_csv("input/ITPD_E_R02_131.csv")
itpder2_132 <- read_csv("input/ITPD_E_R02_132.csv")
itpder2_133 <- read_csv("input/ITPD_E_R02_133.csv")
itpder2_134 <- read_csv("input/ITPD_E_R02_134.csv")
itpder2_135 <- read_csv("input/ITPD_E_R02_135.csv")
itpder2_136 <- read_csv("input/ITPD_E_R02_136.csv")
itpder2_137 <- read_csv("input/ITPD_E_R02_137.csv")
itpder2_138 <- read_csv("input/ITPD_E_R02_138.csv")
itpder2_139 <- read_csv("input/ITPD_E_R02_139.csv")
itpder2_140 <- read_csv("input/ITPD_E_R02_140.csv")
itpder2_141 <- read_csv("input/ITPD_E_R02_141.csv")
itpder2_142 <- read_csv("input/ITPD_E_R02_142.csv")
itpder2_143 <- read_csv("input/ITPD_E_R02_143.csv")
itpder2_144 <- read_csv("input/ITPD_E_R02_144.csv")
itpder2_145 <- read_csv("input/ITPD_E_R02_145.csv")
itpder2_146 <- read_csv("input/ITPD_E_R02_146.csv")
itpder2_147 <- read_csv("input/ITPD_E_R02_147.csv")
itpder2_148 <- read_csv("input/ITPD_E_R02_148.csv")
itpder2_149 <- read_csv("input/ITPD_E_R02_149.csv")
itpder2_150 <- read_csv("input/ITPD_E_R02_150.csv")
itpder2_151 <- read_csv("input/ITPD_E_R02_151.csv")
itpder2_152 <- read_csv("input/ITPD_E_R02_152.csv")
itpder2_153 <- read_csv("input/ITPD_E_R02_153.csv")
itpder2_154 <- read_csv("input/ITPD_E_R02_154.csv")
itpder2_155 <- read_csv("input/ITPD_E_R02_155.csv")
itpder2_156 <- read_csv("input/ITPD_E_R02_156.csv")
itpder2_157 <- read_csv("input/ITPD_E_R02_157.csv")
itpder2_158 <- read_csv("input/ITPD_E_R02_158.csv")
itpder2_159 <- read_csv("input/ITPD_E_R02_159.csv")
itpder2_160 <- read_csv("input/ITPD_E_R02_160.csv")
itpder2_161 <- read_csv("input/ITPD_E_R02_161.csv")
itpder2_162 <- read_csv("input/ITPD_E_R02_162.csv")
itpder2_163 <- read_csv("input/ITPD_E_R02_163.csv")
itpder2_164 <- read_csv("input/ITPD_E_R02_164.csv")
itpder2_165 <- read_csv("input/ITPD_E_R02_165.csv")
itpder2_166 <- read_csv("input/ITPD_E_R02_166.csv")
itpder2_167 <- read_csv("input/ITPD_E_R02_167.csv")
itpder2_168 <- read_csv("input/ITPD_E_R02_168.csv")
itpder2_169 <- read_csv("input/ITPD_E_R02_169.csv")
itpder2_170 <- read_csv("input/ITPD_E_R02_170.csv")

# Filter all datasets from 2000 to 2019 and save as RDS files
# Create output directory if it doesn't exist
dir.create("input", recursive = TRUE, showWarnings = FALSE)

# Loop through all 170 datasets
for (i in 1:170) {
    # Create variable name
    var_name <- paste0("itpder2_", i)
    
    # Filter the dataset
    filtered_data <- get(var_name) %>% 
        filter(year >= 2000 & year <= 2019)
    
    # Assign filtered data back to original variable
    assign(var_name, filtered_data)
    
    # Save as RDS file
    file_name <- paste0("input/", var_name, ".rds")
    saveRDS(filtered_data, file = file_name)
    
    # Print progress
    cat("Processed dataset", i, "of 170\n")
}



##################################################################
# End of code ----------------------------------------------------
##################################################################